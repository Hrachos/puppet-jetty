sudo: false

before_install:
  - ln -s . jetty

cache:
  - apt
  - bundler

addons:
  apt:
    packages:
    - rpm

rvm:
  - 1.9.3

script:
  - curl -s https://raw.githubusercontent.com/visibilityspots/ci-scripts/master/puppet/puppet-lintian-validation.sh | bash -s jetty
  - lint_state=$?
  - curl -s https://raw.githubusercontent.com/visibilityspots/ci-scripts/master/puppet/puppet-syntax-validation.sh | bash -s jetty
  - syntax_state=$?
  - if [ $lint_state -eq 0 ] && [ $syntax_state -eq 0 ] && [ "${TRAVIS_PULL_REQUEST}" == "false" ]; then curl -s https://raw.githubusercontent.com/visibilityspots/ci-scripts/master/puppet/remove-previous-package.sh | bash -s; else echo 'Lint/syntax checks failed or it consist of a pull request so no package stuff will be performed'; fi
  - if [ $lint_state -eq 0 ] && [ $syntax_state -eq 0 ] && [ "${TRAVIS_PULL_REQUEST}" == "false" ]; then curl -s https://raw.githubusercontent.com/visibilityspots/ci-scripts/master/puppet/package-puppet-module.sh | bash -s jetty development; else echo 'Lint/syntax checks failed or it consist of a pull request so no package stuff will be performed'; fi
  - if [ $lint_state -eq 0 ] && [ $syntax_state -eq 0 ] && [ ${TRAVIS_PULL_REQUEST}" != "false" ]; then bundle exec package_cloud push visibilityspots/puppet-development-modules/el/6 *.rpm; else echo 'Lint/syntax checks failed or it consist of a pull request so no package stuff will be performed'; fi

notifications:
  email:
    - travis@visibilityspots.com
